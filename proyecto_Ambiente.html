<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"></meta>
    <title>Proyecto Ambiente</title>
   <script src="file:///C:/Users/Laboratorios/Downloads/jquery-3.3.1.js"></script>
    <link rel="stylesheet" type="text/css" href="file:///C:/Users/Laboratorios/Downloads/DataTables/DataTables-1.10.16/css/jquery.dataTables.css"/>
    <script type="text/javascript" src="file:///C:/Users/Laboratorios/Downloads/DataTables/datatables.js"></script>
    <script type="text/javascript">
           $(document).ready(function() {

//Esta es la tabla de los 87 Personajes
  var table = $('#example').DataTable( {
        "columns": [
            { "data": "name" },
            { "data": "height" },
            { "data": "hair_color" },
            { "data": "skin_color" },
            { "data": "gender" }
        ]
    } );

  //Tabla de busqyeda

  var tableThree = $('#exampleThree').DataTable({
    "columns": [{
        "title": "Name",
        "data": "name"
      },
      {
        "title": "Height",
        "data": "height"
      },
      {
        "title": "Hair Colour",
        "data": "hair_color"
      },
      {
        "title": "Skin Colour",
        "data": "skin_color"
      },
      {
        "title": "Gender",
        "data": "gender"
      }
    ]
  });
 
 //var i=0;
//Esta es la tabla para llenar con la infromacion de peliculas, naves y vehiculos del personaje seleccionado de la tabla
var tableDos = $('#pelis').DataTable({
    data: nomPeli,
    columns: [
            { title: "Peliculas" }
        ]
  });

var tabVehi = $('#vehiculos').DataTable({
    data: nomVehi,
    columns: [
            { title: "Vehiculos" }
        ]
  });

var tabStar = $('#starships').DataTable({
    data: nomStar,
     columns: [
            { title: "Naves Espaciales" }
        ]
  });
 

//Llamadas AJAX para los personajes
  
 var a= $.ajax({
     url: 'https://swapi.co/api/people/',
     dataType: 'json',
 });

  var b=$.ajax({
     url: 'https://swapi.co/api/people/?page=2',
     dataType: 'json',
 });

   var c=$.ajax({
     url: 'https://swapi.co/api/people/?page=3',
     dataType: 'json',
 });

   var d= $.ajax({
     url: 'https://swapi.co/api/people/?page=4',
     dataType: 'json',
 });

     var e= $.ajax({
     url: 'https://swapi.co/api/people/?page=5',
     dataType: 'json',
 });

        var f=$.ajax({
     url: 'https://swapi.co/api/people/?page=6',
     dataType: 'json',
 });

         var g= $.ajax({
     url: 'https://swapi.co/api/people/?page=7',
     dataType: 'json',
 });

            var h=$.ajax({
     url: 'https://swapi.co/api/people/?page=8',
     dataType: 'json',
 });

             var i= $.ajax({
     url: 'https://swapi.co/api/people/?page=9',
     dataType: 'json',
     
 });//Aqui termina llamadas AJAX de personajes

             $.when(a,b, c, d, e, f, g, h, i).done(function(rA,rB, rC, rD, rE, rF, rG, rH, rI){
                table.rows.add(rA[0].results).draw();
                 table.rows.add(rB[0].results).draw();
                  table.rows.add(rC[0].results).draw();
                   table.rows.add(rD[0].results).draw();
                    table.rows.add(rE[0].results).draw();
                     table.rows.add(rF[0].results).draw();
                      table.rows.add(rG[0].results).draw();
                       table.rows.add(rH[0].results).draw();
                        table.rows.add(rI[0].results).draw();
             })


//Esto es para que cuando a√±guien seleccione algun personaje de la tabla, se envie la informacion a la tabla dos y muestre peliculas, naves y vehiculos
var arrayPeli=[];
var arrayVehi=[];
var arrayStar=[];
var nomPeli=[];
var nomVehi=[];
var nomStar=[];
      $('#example tbody').on('click', 'tr', function () {
        tableDos.clear().draw();
        tabVehi.clear().draw();
        tabStar.clear().draw();
        nomPeli=[];
        nomVehi=[];
        nomStar=[];
        var data = table.row( this ).data();
        alert( 'You clicked on '+data.name+'\'s row' );
         $.ajax({
     url: data.url,
     dataType: 'json',
 }).done(function(json) {
    arrayPeli=json.films;
    arrayVehi=json.vehicles;
    arrayStar=json.starships;

$.each(arrayPeli, function (index, value) {
      var peli= 
      $.ajax({
       url: value,
       dataType: 'json',
       success: function(json){
         nomPeli.push(json.title)
         pintarPeliculas(arrayPeli, nomPeli);
       }
 });
});
   
      $.each(arrayVehi, function (index, value) {
     var vehi=  $.ajax({
     url: value,
     dataType: 'json',
     success: function(json){
     nomVehi.push(json.name)
     pintarVehiculos(arrayVehi, nomVehi);
     }
 });
});

       $.each(arrayStar, function (index, value) {
      var star=$.ajax({
     url: value,
     dataType: 'json',
     success: function(json){
     nomStar.push(json.name)
     pintarStarships(arrayStar, nomStar);
     }
 });
});
 });

    } );

      function pintarPeliculas(arrayPeli, nomPeli){
        if(arrayPeli.length==nomPeli.length){
           tableDos.row.add([nomPeli]).draw();
        }
           
      }

        function pintarVehiculos(arrayVehi, nomVehi){
        if(arrayVehi.length==nomVehi.length){
           tabVehi.row.add([nomVehi]).draw();
        }
           
      }

        function pintarStarships(arrayStar, nomStar){
        if(arrayStar.length==nomStar.length){
           tabStar.row.add([nomStar]).draw();
        }
           
      }

//Esto es el buscador de personajes de prueba
$('#boton').click(function() {
    var text= $('#busca').val()
    var url= 'https://swapi.co/api/people/?search='+text;
    console.log(url)
     $.ajax({
     url: url,
     dataType: 'json',
 }).done(function(json){
      tableThree.rows.add(json.results).draw();
  });
})
} );
    </script>
    
</head>
<body>


    <input type="text" id="busca" ></input>
    <input type="button" name="" id="boton" value="Buscar"></input>
<table id="example" class="display" style="width:100%">
        <thead>
            <tr>
                <th>Nombre</th>
                <th>Altura</th>
                <th>Color de Pelo</th>
                <th>Color de Piel</th>
                <th>Genero</th>
            </tr>
        </thead>
      
    </table>

    <table id="pelis" class="display" style="width:100%"> 
    </table>

      <table id="vehiculos" class="display" style="width:100%"> 
    </table>

      <table id="starships" class="display" style="width:100%"> 
    </table>

    <table id="exampleThree" class="display" style="width:100%">
        <thead>
            <tr>
                <th>Nombre</th>
                <th>Altura</th>
                <th>Color de Pelo</th>
                <th>Color de Piel</th>
                <th>Genero</th>
            </tr>
        </thead>
      
    </table>
</body>
</html>