<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"></meta>
    <title>Proyecto Ambiente</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css"/>
    <script type="text/javascript" src="https://cdn.datatables.net/v/dt/dt-1.10.16/datatables.min.js"></script>
    <script type="text/javascript">
           $(document).ready(function() {

//Esta es la tabla de los 87 Personajes
  var table = $('#example').DataTable( {
        "columns": [
            { "data": "name" },
            { "data": "height" },
            { "data": "hair_color" },
            { "data": "skin_color" },
            { "data": "gender" }
        ]
    } );

  //Tabla de busqyeda

  var tableThree = $('#exampleThree').DataTable({
    "columns": [{
        "title": "Name",
        "data": "name"
      },
      {
        "title": "Height",
        "data": "height"
      },
      {
        "title": "Hair Colour",
        "data": "hair_color"
      },
      {
        "title": "Skin Colour",
        "data": "skin_color"
      },
      {
        "title": "Gender",
        "data": "gender"
      }
    ]
  });
 
 //var i=0;
//Esta es la tabla para llenar con la infromacion de peliculas, naves y vehiculos del personaje seleccionado de la tabla
var tableDos = $('#exampleDos').DataTable({
    "columns": [{
        "title": "Films",
        "data": "films",
        render: function (data, type, row, meta) {
            var currentCell = $("#exampleDos").DataTable().cells({"row":meta.row, "column":meta.col}).nodes(0);
      //      $.each(data, function (i, item){  

                 $.ajax({
                url: data[0],
                success: function(json){
                    console.log(json)
                       $(currentCell).text(json.title);          
                }
            });       
          //  })
            return null;
        }
      },
      {
        "title": "Vehicles",
        "data": "vehicles"
      },
       {
        "title": "Starships",
        "data": "starships"
      }
    ]
  });
 

//Llamadas AJAX para los personajes
  
  $.ajax({
     url: 'https://swapi.co/api/people/',
     dataType: 'json',
     success: function(json){
       table.rows.add(json.results).draw();
   }
 });

  $.ajax({
     url: 'https://swapi.co/api/people/?page=2',
     dataType: 'json',
     success: function(json){
       table.rows.add(json.results).draw();
   }
 });

   $.ajax({
     url: 'https://swapi.co/api/people/?page=3',
     dataType: 'json',
     success: function(json){
       table.rows.add(json.results).draw();
   }
 });

    $.ajax({
     url: 'https://swapi.co/api/people/?page=4',
     dataType: 'json',
     success: function(json){
       table.rows.add(json.results).draw();
   }
 });

      $.ajax({
     url: 'https://swapi.co/api/people/?page=5',
     dataType: 'json',
     success: function(json){
       table.rows.add(json.results).draw();
   }
 });

        $.ajax({
     url: 'https://swapi.co/api/people/?page=6',
     dataType: 'json',
     success: function(json){
       table.rows.add(json.results).draw();
   }
 });

          $.ajax({
     url: 'https://swapi.co/api/people/?page=7',
     dataType: 'json',
     success: function(json){
       table.rows.add(json.results).draw();
   }
 });

            $.ajax({
     url: 'https://swapi.co/api/people/?page=8',
     dataType: 'json',
     success: function(json){
       table.rows.add(json.results).draw();
   }
 });

              $.ajax({
     url: 'https://swapi.co/api/people/?page=9',
     dataType: 'json',
     success: function(json){
console.log(json)
console.log(json.results)
       table.rows.add(json.results).draw();
   }
 });//Aqui termina llamadas AJAX de personajes


//Esto es para que cuando a√±guien seleccione algun personaje de la tabla, se envie la informacion a la tabla dos y muestre peliculas, naves y vehiculos
      $('#example tbody').on('click', 'tr', function () {
        var data = table.row( this ).data();
        alert( 'You clicked on '+data.name+'\'s row' );
         $.ajax({
     url: data.url,
     dataType: 'json',
     success: function(json){
     console.log(json)
       tableDos.rows.add([json]).draw();
   }
 });

    } );

//Esto es el buscador de personajes de prueba
$('#boton').click(function() {
    var text= $('#busca').val()
    var url= 'https://swapi.co/api/people/?search='+text;
    console.log(url)
     $.ajax({
     url: url,
     dataType: 'json',
     success: function(json){
        console.log(json)
        console.log(json.results)
       tableThree.rows.add(json.results).draw();
   }
 });
})
} );
    </script>
    
</head>
<body>


    <input type="text" id="busca" ></input>
    <input type="button" name="" id="boton" value="Buscar"></input>
<table id="example" class="display" style="width:100%">
        <thead>
            <tr>
                <th>Nombre</th>
                <th>Altura</th>
                <th>Color de Pelo</th>
                <th>Color de Piel</th>
                <th>Genero</th>
            </tr>
        </thead>
      
    </table>

    <table id="exampleDos" class="display" style="width:100%"> 
    </table>

    <table id="exampleThree" class="display" style="width:100%">
        <thead>
            <tr>
                <th>Nombre</th>
                <th>Altura</th>
                <th>Color de Pelo</th>
                <th>Color de Piel</th>
                <th>Genero</th>
            </tr>
        </thead>
      
    </table>
</body>
</html>